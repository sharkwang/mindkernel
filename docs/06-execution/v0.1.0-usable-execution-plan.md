# MindKernel v0.1.0-usable 执行计划（Execution Plan）

_创建时间：2026-02-21（Asia/Shanghai）_

> 目标：从“原型可跑”推进到“工程可守护”，产出一个可复现、可校验、可交付的 `v0.1.0-usable` 版本。

---

## 0. 目标定义（DoD）

当且仅当以下条件全部满足，判定为“可用版本”：

1. `main` 分支可一键执行关键校验并通过；
2. CI 覆盖关键链路（critical-path + memory-index + 新增脚本最小校验）；
3. 数据入口链路可复现：`memory.md/session -> memory objects(JSONL) -> 导入`；
4. 输出报告可审计（smoke + migration + recall 质量基线）；
5. 有最小运行手册（输入、命令、输出、失败处理）。

---

## 1. 当前基线（Snapshot）

- 主线能力：M→E→C→D 原型可运行，关键路径 15 场景可验证。
- 已完成增强（待并入主线）：
  - memory-index CI 接入
  - RTM 记忆层映射补齐
  - memory-index 可用性增强（增量 reindex / 幂等去重 / 失败重试）
  - `memory.md -> objects` dry-run 迁移脚本
  - session JSONL 解析脚本 + memory.schema 兼容 JSONL 输出

---

## 2. 总体阶段规划（S1~S11）

> 约定：每一步必须有“输入-动作-输出-验收”。

### S1. 基线固化（代码审查 + 提交切分）

- **输入**
  - 工作区未提交变更（workflow/docs/tools）
  - 本地验证结果（scenarios/memory-index/smoke）
- **动作**
  1. 逐文件审查改动质量与一致性；
  2. 按主题拆分提交（CI、文档、核心脚本、迁移脚本）；
  3. 形成可审阅提交序列（必要时本地 tag 标记）。
- **输出**
  - 干净的 commit 序列
  - 提交说明（每个 commit 的影响面与回滚点）
- **验收标准**
  - 无混杂提交（一个 commit 一个主题）
  - 本地回归通过

### S2. 文档对齐（状态/风险与现实一致）

- **输入**
  - `TODO.md`、`rtm-v0.1.md`、最新 smoke 报告
- **动作**
  1. 修正 TODO 中“已完成项/风险项”不一致描述；
  2. 更新“下一步”到当前真实优先级（P1/P2）；
  3. 在 docs 中记录本轮里程碑与证据路径。
- **输出**
  - 一致且可信的项目状态文档
- **验收标准**
  - 文档无自相矛盾
  - 每个“已完成”项可定位到代码证据

### S3. 验证门禁固化（本地 + CI）

- **输入**
  - `tools/validate_scenarios_v0_1.py`
  - `tools/validate_memory_index_v0_1.py`
  - `.github/workflows/critical-path-validation.yml`
- **动作**
  1. 本地连续执行关键验证；
  2. 触发 CI 并核对结果；
  3. 归档 smoke 报告。
- **输出**
  - 可复现验证记录（json/md）
- **验收标准**
  - 本地绿 + CI 绿

### S4. 数据入口契约冻结（Ingest Contract）

- **输入**
  - `migrate_memory_md_to_objects_v0_1.py`
  - `parse_session_jsonl_v0_1.py`
  - `schemas/memory.schema.json`
- **动作**
  1. 明确字段映射、必填规则、幂等键；
  2. 明确错误隔离策略（单条失败不阻断整体）；
  3. 增加 ingest contract 文档。
- **输出**
  - `docs/02-design/*ingest-contract*.md`
- **验收标准**
  - 任一输入样例都能按契约解释

### S5. 导入器实现（JSONL -> memory objects）

- **输入**
  - memory.schema 兼容 JSONL
- **动作**
  1. 新增 `import_memory_objects_v0_1.py`；
  2. 支持 upsert/去重/错误隔离；
  3. 输出导入统计与失败清单。
- **输出**
  - 导入脚本 + 导入报告
- **验收标准**
  - 重复导入幂等

### S6. 导入回放测试

- **输入**
  - fixture + session 导出 JSONL
- **动作**
  1. 新增 `validate_memory_import_v0_1.py`；
  2. 校验计数、引用链、幂等行为。
- **输出**
  - 回放测试脚本 + 报告
- **验收标准**
  - 导入质量可量化

### S7. Reflect 调度接入（默认 dry-run）

- **输入**
  - scheduler 原型 + memory_index reflect
- **动作**
  1. 增加 reflect-dryrun 作业类型；
  2. 加入调度执行与审计记录；
  3. 默认不写回，保留人工确认钩子。
- **输出**
  - scheduler 联动作业最小实现
- **验收标准**
  - 到期作业可触发、可追踪、可重试

### S8. Opinion 演化规则增强

- **输入**
  - 当前启发式极性判定
- **动作**
  1. 增加冲突聚类/更稳健极性判定；
  2. 增加回放样例与断言。
- **输出**
  - 规则增强实现 + 测试证据
- **验收标准**
  - 误判率下降（以回放基线衡量）

### S9. Recall 质量基线

- **输入**
  - query->期望 fact 的标注样本
- **动作**
  1. 新增 `validate_recall_quality_v0_1.py`；
  2. 输出 accuracy/recall/noise 指标。
- **输出**
  - recall 质量报告
- **验收标准**
  - 指标可复现、可对比

### S10. 发布前总检（Release Check）

- **输入**
  - 所有脚本、文档、CI 配置
- **动作**
  1. 新增 `release_check_v0_1.py` 一键总检；
  2. 汇总各项报告。
- **输出**
  - 发布门禁结果（PASS/FAIL）
- **验收标准**
  - 无阻断项

### S11. 版本产出（v0.1.0-usable）

- **输入**
  - 总检通过的 main
- **动作**
  1. 生成 changelog；
  2. 打 tag；
  3. 发布 runbook。
- **输出**
  - `v0.1.0-usable` 发布包
- **验收标准**
  - 新环境可按 runbook 复现

---

## 3. 执行状态跟踪

- [x] S1 基线固化
- [x] S2 文档对齐
- [ ] S3 验证门禁固化
- [ ] S4 数据入口契约冻结
- [ ] S5 导入器实现
- [ ] S6 导入回放测试
- [ ] S7 Reflect 调度接入
- [ ] S8 Opinion 规则增强
- [ ] S9 Recall 质量基线
- [ ] S10 发布前总检
- [ ] S11 版本产出

---

## 4. 本次执行记录（滚动更新）

- 2026-02-21：创建执行计划文档，准备启动 S1。
- 2026-02-21：完成 S1（代码审查 + 提交切分 + 本地回归）。提交序列：
  - `ef913a6` docs(ci): close P0 docs loop and record v0.1.0 usable execution plan
  - `3c7ca7b` feat(memory-index): add incremental reindex, idempotent upsert, and retryable failures
  - `2d45476` feat(ingest): add memory.md migration dry-run and session->memory parser
- 2026-02-21：完成 S2（文档对齐），更新 TODO 风险口径与 discussion log 执行记录，确保“状态-证据-下一步”一致。
